{% extends "base.html" %}
{% block content %}

<div class="container py-5">

  <!-- 🔒 Secure Header -->
  <div class="text-center mb-5">
    <h2 class="fw-bold text-primary">
      <i class="bi bi-person-badge-fill me-2"></i> One-Time Patient Access
    </h2>
    <p class="text-muted">
      You are viewing a secure, single-use patient record. Please review responsibly.
    </p>
  </div>

  <!-- 🩺 Patient Basic Info -->
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-primary text-white fw-semibold">
          <i class="bi bi-person-vcard me-2"></i> Patient Information
        </div>
        <div class="card-body p-4">
          <div class="row mb-3">
            <div class="col-sm-4 text-muted">Name</div>
            <div class="col-sm-8 fw-semibold">{{ patient.name }}</div>
          </div>
          <div class="row mb-3">
            <div class="col-sm-4 text-muted">Diagnosis</div>
            <div class="col-sm-8">{{ patient.diagnosis }}</div>
          </div>
          <div class="row">
            <div class="col-sm-4 text-muted">Viewed At</div>
            <div class="col-sm-8">{{ now.strftime('%Y-%m-%d %H:%M:%S') }}</div>
          </div>
        </div>
      </div>

      <!-- 📋 Past Medical History -->
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-secondary text-white fw-semibold">
          <i class="bi bi-journal-medical me-2"></i> Medical History
        </div>
        <div class="card-body p-4">
          {% if history %}
            <div class="table-responsive">
              <table class="table table-bordered table-hover">
                <thead class="table-light">
                  <tr>
                    <th>Visit Date</th>
                    <th>Checkup Result</th>
                    <th>Doctor Notes</th>
                    <th>Recorded At</th>
                  </tr>
                </thead>
                <tbody>
                  {% for entry in history %}
                    <tr>
                      <td>{{ entry.visit_date }}</td>
                      <td>{{ entry.checkup_result }}</td>
                      <td>{{ entry.doctor_notes or "N/A" }}</td>
                      <td>{{ entry.created_at }}</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% else %}
            <div class="alert alert-info">
              No medical history records available.
            </div>
          {% endif %}
        </div>
      </div>

      <!-- ⛔ Expiry Note -->
      <div class="alert alert-warning d-flex align-items-start shadow-sm">
        <i class="bi bi-shield-lock-fill fs-4 me-3"></i>
        <div>
          <strong>This link is now expired.</strong><br>
          It was valid for a single secure session and cannot be reused.
        </div>
      </div>

      <!-- 🔐 Legal Note -->
      <div class="text-center text-muted small mt-4">
        <i class="bi bi-shield-check me-1"></i>
        Healthcare confidentiality applies. This view was logged for audit.
      </div>

    </div>
  </div>
</div>

{% endblock %}
