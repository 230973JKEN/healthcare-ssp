{% extends "base.html" %}
{% block content %}

<div class="container py-4">

  <!-- ü©∫ Dashboard Header -->
  <div class="text-center mb-4">
    <h2 class="fw-bold text-primary"><i class="bi bi-clipboard2-pulse"></i> Doctor Dashboard</h2>
    <p class="text-muted">Welcome! View and manage your patients below.</p>
  </div>

  <!-- üîî Flash Message -->
  {% if message %}
    <div class="alert alert-success text-center shadow-sm">
      <i class="bi bi-check-circle-fill"></i> {{ message }}
    </div>
  {% endif %}

  <!-- üìã Patient Records -->
  <div class="card border-0 shadow-sm mb-5">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0"><i class="bi bi-person-lines-fill me-2"></i>Patient Records</h5>
    </div>
    <div class="card-body px-0 pt-0">
      <div class="table-responsive">
        <table class="table table-bordered table-hover mb-0">
          <thead class="table-light text-center">
            <tr>
              <th scope="col">ID</th>
              <th scope="col">Name</th>
              <th scope="col">Diagnosis</th>
              <th scope="col">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for patient in patients %}
              <tr>
                <td class="text-center">{{ patient.patient_id }}</td>
                <td>
                  <a href="{{ url_for('view_patient_detail', patient_id=patient.patient_id) }}" class="text-decoration-none fw-semibold">
                    {{ patient.name }}
                  </a>
                </td>
                <td>{{ patient.diagnosis }}</td>
                <td class="text-center">
                  <form method="post" action="{{ url_for('share_link_ui', patient_id=patient.patient_id) }}" class="d-flex flex-wrap gap-2 justify-content-center align-items-center">
                    <select name="expires" class="form-select form-select-sm" style="width: auto; min-width: 80px;">
                      <option value="5">5 min</option>
                      <option value="15">15 min</option>
                      <option value="30">30 min</option>
                      <option value="60">1 hour</option>
                    </select>
                    <button type="submit" class="btn btn-sm btn-outline-primary">
                      <i class="bi bi-link-45deg"></i> Generate
                    </button>
                  </form>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- üîó Copied Link Section -->
  {% if copied_link %}
    <div class="alert alert-info shadow-sm d-flex align-items-center mt-4">
      <i class="bi bi-link-45deg me-2"></i>
      <div class="flex-grow-1">
        <label for="copyLink" class="form-label mb-1 fw-semibold">Generated Link (click to copy):</label>
        <input id="copyLink" class="form-control" type="text" value="{{ copied_link }}" onclick="this.select();" readonly autofocus>
      </div>
    </div>
  {% endif %}

  <!-- üì¶ Create & Update Forms -->
  <div class="row g-4 mt-5">

    <!-- ‚ûï Create Patient -->
    <div class="col-md-6">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-header bg-success text-white">
          <h5 class="mb-0"><i class="bi bi-person-plus-fill me-2"></i>Create Patient</h5>
        </div>
        <div class="card-body">
          <form method="post" action="/doctor/create">
            <div class="mb-3">
              <label class="form-label">Name</label>
              <input type="text" class="form-control" name="name" placeholder="Enter patient name" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Diagnosis</label>
              <input type="text" class="form-control" name="diagnosis" placeholder="Initial diagnosis" required>
            </div>
            <button type="submit" class="btn btn-success w-100">
              <i class="bi bi-plus-circle"></i> Create Patient
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- üîÑ Update Patient -->
    <div class="col-md-6">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-header bg-info text-white">
          <h5 class="mb-0"><i class="bi bi-pencil-square me-2"></i>Update Patient (Dropdown)</h5>
        </div>
        <div class="card-body">
          <form method="post" action="{{ url_for('update_patient') }}">
            <div class="mb-3">
              <label class="form-label">Select Patient</label>
              <select class="form-select" name="patient_id" required>
                {% for patient in patients %}
                  <option value="{{ patient.patient_id }}">
                    {{ patient.name }} (ID: {{ patient.patient_id }})
                  </option>
                {% endfor %}
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">Diagnosis</label>
              <input type="text" class="form-control" name="diagnosis" placeholder="Update diagnosis" required>
            </div>
            <button type="submit" class="btn btn-info w-100 text-white">
              <i class="bi bi-arrow-clockwise"></i> Update Patient
            </button>
          </form>
        </div>
      </div>
    </div>

  </div>
</div>
<!-- üîê Link to Remote Device Management -->
<a href="{{ url_for('doctor_devices') }}" class="btn btn-warning">
    üñ•Ô∏è Manage My Devices
</a>

<a href="{{ url_for('doctor_devices') }}" class="btn btn-outline-primary mt-3">
    üîê View Logged-In Devices
</a>

{% endblock %}
